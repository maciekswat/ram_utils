

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Pipelines and Tasks &mdash; Ramutils 2.3.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Command-line usage" href="cli.html" />
    <link rel="prev" title="Event processing" href="events.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Ramutils
          

          
          </a>

          
            
            
              <div class="version">
                2.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started_report_data.html">Getting Started: RAM Report Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Serializable data structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="classifier.html">Classifier training, cross validation, and utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="events.html">Event processing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Pipelines and Tasks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#existing-pipelines">Existing Pipelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tasks">Tasks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#defining-tasks">Defining tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reference">Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-ramutils.tasks.classifier">Classifier tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-ramutils.tasks.events">Events tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-ramutils.tasks.misc">Miscellaneous tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-ramutils.tasks.montage">Montage tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-ramutils.tasks.odin">Odin/Ramulator tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-ramutils.tasks.powers">Power computation tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-ramutils.tasks.summary">Report summary tasks</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command-line usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">Miscellaneous utilities</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Ramutils</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Pipelines and Tasks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/pipeline.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="pipelines-and-tasks">
<h1>Pipelines and Tasks<a class="headerlink" href="#pipelines-and-tasks" title="Permalink to this headline">¶</a></h1>
<p>Experiment configuration file generation and post-experiment reporting is done
via a series of tasks that are built up into a pipeline using <a class="reference external" href="http://dask.pydata.org/en/latest/index.html">dask</a>.</p>
<div class="section" id="existing-pipelines">
<h2>Existing Pipelines<a class="headerlink" href="#existing-pipelines" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ramutils.pipelines.ramulator_config.make_ramulator_config">
<code class="descclassname">ramutils.pipelines.ramulator_config.</code><code class="descname">make_ramulator_config</code><span class="sig-paren">(</span><em>subject</em>, <em>experiment</em>, <em>paths</em>, <em>stim_params</em>, <em>sessions=None</em>, <em>exp_params=None</em>, <em>vispath=None</em>, <em>extended_blanking=True</em>, <em>localization=0</em>, <em>montage=0</em>, <em>default_surface_area=0.001</em>, <em>trigger_pairs=None</em>, <em>use_common_reference=False</em>, <em>use_classifier_excluded_leads=False</em>, <em>pipeline_name='ramulator-conf'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/pipelines/ramulator_config.html#make_ramulator_config"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.pipelines.ramulator_config.make_ramulator_config" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate configuration files for a Ramulator experiment</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>subject</strong> (<em>str</em>) – Subject ID</li>
<li><strong>experiment</strong> (<em>str</em>) – Experiment to generate configuration file for</li>
<li><strong>paths</strong> (<a class="reference internal" href="data.html#ramutils.parameters.FilePaths" title="ramutils.parameters.FilePaths"><em>FilePaths</em></a>) – </li>
<li><strong>stim_params</strong> (<em>List</em><em>[</em><a class="reference internal" href="data.html#ramutils.parameters.StimParameters" title="ramutils.parameters.StimParameters"><em>StimParameters</em></a><em>]</em>) – Stimulation parameters for this experiment.</li>
<li><strong>sessions</strong> (<em>List</em><em>[</em><em>int</em><em>]</em>) – Sessions to include when training classifier</li>
<li><strong>exp_params</strong> (<a class="reference internal" href="data.html#ramutils.parameters.ExperimentParameters" title="ramutils.parameters.ExperimentParameters"><em>ExperimentParameters</em></a>) – Parameters for the experiment.</li>
<li><strong>vispath</strong> (<em>str</em>) – Path to save task graph visualization to if given.</li>
<li><strong>extended_blanking</strong> (<em>bool</em>) – Whether to enable extended blanking on the ENS (default: True).</li>
<li><strong>localization</strong> (<em>int</em>) – Localization number</li>
<li><strong>montage</strong> (<em>int</em>) – Montage number</li>
<li><strong>default_surface_area</strong> (<em>float</em>) – Default surface area to set all electrodes to in mm^2. Only used if no
area file can be found.</li>
<li><strong>trigger_pairs</strong> (<em>List</em><em>[</em><em>str</em><em>] or </em><em>None</em>) – Pairs to use for triggering stim in PS5 experiments.</li>
<li><strong>use_common_reference</strong> (<em>bool</em>) – Use a common reference in the electrode configuration instead of bipolar
referencing.</li>
<li><strong>use_classifier_excluded_leads</strong> (<em>bool</em>) – Use contents of classifier_excluded_leads.txt to exclude channels from
classifier training</li>
<li><strong>pipeline_name</strong> (<em>str</em>) – Name to use for status updates.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">The path to the generated configuration zip file.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>The main steps of this pipeline are:</p>
<ul class="simple">
<li><code class="xref py py-func docutils literal notranslate"><span class="pre">generate_pairs_from_electrode_config()</span></code></li>
<li><a class="reference internal" href="#ramutils.tasks.events.build_training_data" title="ramutils.tasks.events.build_training_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">build_training_data()</span></code></a></li>
<li><a class="reference internal" href="#ramutils.tasks.powers.compute_normalized_powers" title="ramutils.tasks.powers.compute_normalized_powers"><code class="xref py py-func docutils literal notranslate"><span class="pre">compute_normalized_powers()</span></code></a></li>
<li><code class="xref py py-func docutils literal notranslate"><span class="pre">train_classifier()</span></code></li>
<li><a class="reference internal" href="#ramutils.tasks.classifier.summarize_classifier" title="ramutils.tasks.classifier.summarize_classifier"><code class="xref py py-func docutils literal notranslate"><span class="pre">summarize_classifier()</span></code></a></li>
<li><a class="reference internal" href="#ramutils.tasks.classifier.serialize_classifier" title="ramutils.tasks.classifier.serialize_classifier"><code class="xref py py-func docutils literal notranslate"><span class="pre">serialize_classifier()</span></code></a></li>
<li><a class="reference internal" href="#ramutils.tasks.odin.generate_ramulator_config" title="ramutils.tasks.odin.generate_ramulator_config"><code class="xref py py-func docutils literal notranslate"><span class="pre">generate_ramulator_config()</span></code></a></li>
</ul>
<dl class="function">
<dt id="ramutils.pipelines.report.make_report">
<code class="descclassname">ramutils.pipelines.report.</code><code class="descname">make_report</code><span class="sig-paren">(</span><em>subject</em>, <em>experiment</em>, <em>paths</em>, <em>joint_report=False</em>, <em>retrain=False</em>, <em>stim_params=None</em>, <em>exp_params=None</em>, <em>sessions=None</em>, <em>vispath=None</em>, <em>rerun=False</em>, <em>trigger_electrode=None</em>, <em>use_classifier_excluded_leads=False</em>, <em>pipeline_name='report'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/pipelines/report.html#make_report"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.pipelines.report.make_report" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructs a report and saves out all the necessary data to re-construct the report</p>
<p>This pipeline should be used for generating single session reports for both record-only and
stimulation sessions. However, the current pipeline also support combining sessions of record-only
experiments into a single report. In the future, this capability may be moved to
<cite>ramutils.pipelines.aggregated_report.make_aggregated_report</cite> since that is a more natural location</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>subject</strong> (<em>str</em>) – Subject ID</li>
<li><strong>experiment</strong> (<em>str</em>) – Experiment to generate report for</li>
<li><strong>paths</strong> (<a class="reference internal" href="data.html#ramutils.parameters.FilePaths" title="ramutils.parameters.FilePaths"><em>FilePaths</em></a>) – </li>
<li><strong>joint_report</strong> (<em>Bool</em>) – If True, catFR/FR sessions will be combined in the report</li>
<li><strong>retrain</strong> (<em>Bool</em>) – If True, retrain classifier rather than trying to load from disk</li>
<li><strong>stim_params</strong> (<em>List</em><em>[</em><a class="reference internal" href="data.html#ramutils.parameters.StimParameters" title="ramutils.parameters.StimParameters"><em>StimParameters</em></a><em>]</em>) – Stimulation parameters (empty list for non-stim experiments).</li>
<li><strong>exp_params</strong> (<a class="reference internal" href="data.html#ramutils.parameters.ExperimentParameters" title="ramutils.parameters.ExperimentParameters"><em>ExperimentParameters</em></a>) – When given, overrides the inferred default parameters to use for an
experiment.</li>
<li><strong>sessions</strong> (<em>list</em><em> or </em><em>None</em>) – For reports that span sessions, sessions to read data from.
When not given, all available sessions are used for reports.</li>
<li><strong>vispath</strong> (<em>str</em>) – Filename for task graph visualization.</li>
<li><strong>rerun</strong> (<em>bool</em>) – If True, do not attempt to load data from long-term storage. If any
necessary data is not found, everything will be rerun</li>
<li><strong>trigger_electrode</strong> (<em>str</em>) – The label for the bipolar pair to be used for triggering stimulation
in PS5</li>
<li><strong>use_classifier_excluded_leads</strong> (<em>bool</em>) – Use contents of classifier_excluded_leads.txt to exclude channels from
classifier training</li>
<li><strong>pipeline_name</strong> (<em>str</em>) – Name to use for status updates.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>report_path</strong> – Path to generated report.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">str</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Eventually this will return an object that summarizes all output of the
report rather than the report itself.</p>
</dd></dl>

<p>The main steps of this pipeline are:</p>
<ul class="simple">
<li><a class="reference internal" href="#ramutils.tasks.montage.generate_montage_metadata_table" title="ramutils.tasks.montage.generate_montage_metadata_table"><code class="xref py py-func docutils literal notranslate"><span class="pre">generate_montage_metadata_table()</span></code></a></li>
<li><a class="reference internal" href="#ramutils.tasks.events.build_test_data" title="ramutils.tasks.events.build_test_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">build_test_data()</span></code></a></li>
<li><a class="reference internal" href="#ramutils.tasks.events.build_training_data" title="ramutils.tasks.events.build_training_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">build_training_data()</span></code></a></li>
<li><a class="reference internal" href="#ramutils.tasks.powers.compute_normalized_powers" title="ramutils.tasks.powers.compute_normalized_powers"><code class="xref py py-func docutils literal notranslate"><span class="pre">compute_normalized_powers()</span></code></a></li>
<li>Non-stim reports:<ul>
<li><code class="xref py py-func docutils literal notranslate"><span class="pre">train_classifier()</span></code></li>
<li><a class="reference internal" href="#ramutils.tasks.classifier.summarize_classifier" title="ramutils.tasks.classifier.summarize_classifier"><code class="xref py py-func docutils literal notranslate"><span class="pre">summarize_classifier()</span></code></a> (Encoding + retrieval)</li>
<li><a class="reference internal" href="#ramutils.tasks.classifier.summarize_classifier" title="ramutils.tasks.classifier.summarize_classifier"><code class="xref py py-func docutils literal notranslate"><span class="pre">summarize_classifier()</span></code></a> (Encoding only)</li>
<li><a class="reference internal" href="#ramutils.tasks.summary.summarize_nonstim_sessions" title="ramutils.tasks.summary.summarize_nonstim_sessions"><code class="xref py py-func docutils literal notranslate"><span class="pre">summarize_nonstim_sessions()</span></code></a></li>
</ul>
</li>
<li>Stim reports:<ul>
<li><a class="reference internal" href="#ramutils.tasks.classifier.reload_used_classifiers" title="ramutils.tasks.classifier.reload_used_classifiers"><code class="xref py py-func docutils literal notranslate"><span class="pre">reload_used_classifiers()</span></code></a></li>
<li><a class="reference internal" href="#ramutils.tasks.classifier.post_hoc_classifier_evaluation" title="ramutils.tasks.classifier.post_hoc_classifier_evaluation"><code class="xref py py-func docutils literal notranslate"><span class="pre">post_hoc_classifier_evaluation()</span></code></a></li>
<li><a class="reference internal" href="#ramutils.tasks.summary.summarize_stim_sessions" title="ramutils.tasks.summary.summarize_stim_sessions"><code class="xref py py-func docutils literal notranslate"><span class="pre">summarize_stim_sessions()</span></code></a></li>
<li><code class="xref py py-func docutils literal notranslate"><span class="pre">estimate_effects_of_stim()</span></code></li>
</ul>
</li>
<li><a class="reference internal" href="#ramutils.tasks.summary.summarize_math" title="ramutils.tasks.summary.summarize_math"><code class="xref py py-func docutils literal notranslate"><span class="pre">summarize_math()</span></code></a></li>
<li><a class="reference internal" href="#ramutils.tasks.misc.save_all_output" title="ramutils.tasks.misc.save_all_output"><code class="xref py py-func docutils literal notranslate"><span class="pre">save_all_output()</span></code></a></li>
<li><code class="xref py py-func docutils literal notranslate"><span class="pre">build_static_report()</span></code></li>
</ul>
<dl class="function">
<dt id="ramutils.pipelines.aggregated_report.make_aggregated_report">
<code class="descclassname">ramutils.pipelines.aggregated_report.</code><code class="descname">make_aggregated_report</code><span class="sig-paren">(</span><em>subjects=None</em>, <em>experiments=None</em>, <em>sessions=None</em>, <em>fit_model=True</em>, <em>paths=None</em>, <em>pipeline_name='aggregate'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/pipelines/aggregated_report.html#make_aggregated_report"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.pipelines.aggregated_report.make_aggregated_report" title="Permalink to this definition">¶</a></dt>
<dd><p>Build an aggregated stim session report</p>
<p>This pipeline should be used for combining data across stim experiment sessions into a single report. The concept
of a “joint report” already exists for record-only sessions and can be generated using the
<cite>ramutils.pipelines.report.make_report</cite> pipeline. In the future, a more sensible approach would be to have joint
reports for both stim sessions and record-only sessions be built using the same pipeline.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Keyword Arguments:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><ul class="first last simple">
<li><strong>subjects</strong> (<em>list</em><em> or </em><em>None</em>) – The set of subjects to include when building the report. If None and one or more experiments are specified, then
the subjects who completed each experiment will be identified automatically.</li>
<li><strong>experiments</strong> (<em>list</em><em> or </em><em>None</em>) – The set of experiments to include when building the report. This is primarily useful for combining FR with CatFR
session data, effectively a joint report for stim sessions. However, it is also possible to combine across
experiment series. For example, a joint report could be built that combines FR3, catFR3, FR5, and catFR5. This
is possible because the report templates for these experiments are identical. It is not, however, possible to
combine stim reports across dissimilar reports. For example, it would not make sense to build an aggregate report
combining PS5 with catFR5 since those use completely different templates.</li>
<li><strong>sessions</strong> (<em>list</em><em> or </em><em>None</em>) – The set of sessions to include. This parameter can only be used if a single subject and a single experiment have
been provided. The main use case is for generating a stim report that excludes 1 or more sessions. We do not
currently support the ability to combine the sessions paramter with more than one subject or more than one
experiment. This could be a future enhancement. For example, it may be useful to be able to generate an
aggregated report of all the first sessions of a particular experiment type, or all first sessions for a
particular subject.</li>
<li><strong>fit_model</strong> (<em>bool</em>) – If true, the a Bayesian hierachical multilvel model will be fit using the data combined across the requested
subjects, experiments, and sessions. This process can be very slow as the number of sessions increases, so it
is False by default. The main use case if for building a stim report that aggregates over the sessions that
a particular subject completed of a particular experiment.</li>
<li><strong>paths</strong> (<cite>ramutils.parameters.FilePaths</cite>) – Helper class for setting up the set of paths that will be necessary for loading existing results</li>
<li><strong>pipeline_name</strong> (<em>str</em>) – Name to use for status updates.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="tasks">
<h2>Tasks<a class="headerlink" href="#tasks" title="Permalink to this headline">¶</a></h2>
<div class="section" id="defining-tasks">
<h3>Defining tasks<a class="headerlink" href="#defining-tasks" title="Permalink to this headline">¶</a></h3>
<p>Tasks are created by using the <a class="reference internal" href="#ramutils.tasks.task" title="ramutils.tasks.task"><code class="xref py py-func docutils literal notranslate"><span class="pre">ramutils.tasks.task()</span></code></a> decorator or wrapping
a function with <a class="reference internal" href="#ramutils.tasks.make_task" title="ramutils.tasks.make_task"><code class="xref py py-func docutils literal notranslate"><span class="pre">ramutils.tasks.make_task()</span></code></a>. These simply apply the
<a href="#id1"><span class="problematic" id="id2">:func:`dask.delayed`_</span></a> and (optionally) <a href="#id3"><span class="problematic" id="id4">:module:`joblib`_</span></a> caching decorators. The former
is important for adding the ability to parallelize a pipeline (for tasks that
can run independently) while the latter allows for resuming a pipeline when
something goes wrong or if only changing one parameter which does not affect all
tasks.</p>
<dl class="function">
<dt id="ramutils.tasks.task">
<code class="descclassname">ramutils.tasks.</code><code class="descname">task</code><span class="sig-paren">(</span><em>cache=True</em>, <em>log_args=False</em>, <em>nout=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/tasks/_wrapper.html#task"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.task" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator to define a task.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Keyword Arguments:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><ul class="first last simple">
<li><strong>cache</strong> (<em>bool</em>) – Cache the task result (default: True)</li>
<li><strong>log_args</strong> (<em>bool</em>) – Log arguments the task is called with (default: False)</li>
<li><strong>nout</strong> (<em>int</em>) – Number of return values of the wrapped function. Must be specified if
more than 1.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ramutils.tasks.make_task">
<code class="descclassname">ramutils.tasks.</code><code class="descname">make_task</code><span class="sig-paren">(</span><em>func</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/tasks/_wrapper.html#make_task"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.make_task" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrap a function in a task.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>func</strong> (<em>callable</em>) – Function to wrap</li>
<li><strong>args</strong> – Arguments for the function</li>
<li><strong>kwargs</strong> – Keyword arugments for the function plus keyword arguments accepted by
the <a class="reference internal" href="#ramutils.tasks.task" title="ramutils.tasks.task"><code class="xref py py-func docutils literal notranslate"><span class="pre">task()</span></code></a> decorator.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="reference">
<h3>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h3>
<p>Common tasks come predefined in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">ramutils.tasks</span></code> package and are
documented below.</p>
</div>
<div class="section" id="module-ramutils.tasks.classifier">
<span id="classifier-tasks"></span><h3>Classifier tasks<a class="headerlink" href="#module-ramutils.tasks.classifier" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="ramutils.tasks.classifier.summarize_classifier">
<code class="descclassname">ramutils.tasks.classifier.</code><code class="descname">summarize_classifier</code><span class="sig-paren">(</span><em>classifier</em>, <em>pow_mat</em>, <em>events</em>, <em>n_permutations</em>, <em>tag='classifier'</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/tasks/classifier.html#summarize_classifier"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.classifier.summarize_classifier" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform LOSO or LOLO cross validation on a classifier.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>classifier</strong> (<em>sklearn model object</em>) – </li>
<li><strong>pow_mat</strong> (<em>np.ndarray</em>) – </li>
<li><strong>events</strong> (<em>np.recarray</em>) – </li>
<li><strong>n_permutations</strong> (<em>int</em>) – </li>
<li><strong>tag</strong> (<em>str</em>) – Tag to assign the resulting classifier summary (default:
<code class="docutils literal notranslate"><span class="pre">'classifier'</span></code>)</li>
<li><strong>kwargs</strong> (<em>dict</em>) – Extra keyword arguments that are passed to get_sample_weights. See
that function for more details</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>classifier_summary</strong> – Results of cross validation as a summary object</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference internal" href="data.html#ramutils.reports.summary.ClassifierSummary" title="ramutils.reports.summary.ClassifierSummary">ClassifierSummary</a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ramutils.tasks.classifier.serialize_classifier">
<code class="descclassname">ramutils.tasks.classifier.</code><code class="descname">serialize_classifier</code><span class="sig-paren">(</span><em>classifier</em>, <em>pairs</em>, <em>features</em>, <em>events</em>, <em>sample_weights</em>, <em>classifier_summary</em>, <em>subject</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/tasks/classifier.html#serialize_classifier"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.classifier.serialize_classifier" title="Permalink to this definition">¶</a></dt>
<dd><p>Serialize classifier into a container object</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>classifier</strong> (<em>sklearn Estimator</em>) – Model used during training</li>
<li><strong>pairs</strong> (<em>array_like</em>) – bipolar pairs used for training</li>
<li><strong>features</strong> (<em>np.ndarray</em>) – Normalized power matrix used as features to the classifier</li>
<li><strong>events</strong> (<em>np.recarray</em>) – Set of events used for training</li>
<li><strong>sample_weights</strong> (<em>array_like</em>) – Weights used for each of the event</li>
<li><strong>classifier_summary</strong> (<a class="reference internal" href="data.html#ramutils.reports.summary.ClassifierSummary" title="ramutils.reports.summary.ClassifierSummary"><em>ClassifierSummary</em></a>) – Object used for calculating and storing cross-validation-related metrics</li>
<li><strong>subject</strong> (<em>str</em>) – Subject identifier</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Object representing all meta-data associated with training a classifier</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ClassififerContainer</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ramutils.tasks.classifier.post_hoc_classifier_evaluation">
<code class="descclassname">ramutils.tasks.classifier.</code><code class="descname">post_hoc_classifier_evaluation</code><span class="sig-paren">(</span><em>events</em>, <em>powers</em>, <em>all_pairs</em>, <em>classifiers</em>, <em>n_permutations</em>, <em>retrained_classifier</em>, <em>use_retrained=False</em>, <em>post_stim_events=None</em>, <em>post_stim_powers=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/tasks/classifier.html#post_hoc_classifier_evaluation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.classifier.post_hoc_classifier_evaluation" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate a trained classifier</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>events</strong> (<em>np.recarray</em>) – Task events associated with the stim sessesion to be evaluated</li>
<li><strong>powers</strong> (<em>np.ndarray</em>) – Normalized mean powers</li>
<li><strong>all_pairs</strong> (<em>OrderedDict</em>) – All pairs based on recorded electrodes combine from config file</li>
<li><strong>classifiers</strong> (<em>List</em>) – List of classifiers corresponding to each session</li>
<li><strong>n_permutations</strong> (<em>int</em>) – Number of permutations to use for cross validation</li>
<li><strong>retrained_classifier</strong> (<em>classiflib.container.ClassifierContainer</em>) – classifier container object based on a retrained classifier</li>
<li><strong>use_retrained</strong> (<em>bool</em><em> (</em><em>default False</em><em>)</em>) – Indicates if the retrained classifier should be used over the actual
classifier for the purpose of evaluation</li>
<li><strong>post_stim_events</strong> (<em>np.recarray</em><em> or </em><em>None</em>) – Post-stimulation events associated with the stim sessesion to be
evaluated. Can be done in the case of FR2 where post stim events</li>
<li><strong>post_stim_powers</strong> (<em>np.ndarray</em><em> or </em><em>None</em>) – Normalized mean powers for post_stim period events</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>A dictionary of summary objects that are needed in subsequent parts
of the processing pipeline. The dictionary will be in the following
format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;cross_session_summary&#39;</span><span class="p">:</span> <span class="n">MultiSessionClassifierSummary</span><span class="p">,</span>
    <span class="s1">&#39;classifier_summaries&#39;</span><span class="p">:</span> <span class="n">List</span> <span class="n">of</span> <span class="n">ClassifierSummary</span> <span class="n">objects</span><span class="p">,</span>
    <span class="s1">&#39;encoding_classifier_summaries&#39;</span><span class="p">:</span> <span class="n">List</span> <span class="n">of</span> <span class="n">ClassifierSummary</span>
    <span class="n">objects</span> <span class="n">built</span> <span class="n">using</span> <span class="nb">all</span> <span class="n">encoding</span> <span class="n">events</span><span class="p">,</span>
    <span class="s1">&#39;post_stim_predicted_probs&#39;</span><span class="p">:</span> <span class="n">Classifier</span> <span class="n">output</span> <span class="n">during</span> <span class="n">post</span> <span class="n">stim</span> <span class="n">period</span>
<span class="p">}</span>
</pre></div>
</div>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dict</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Different channels could be excluded based on results of artifact detection
and stim parameters. Extract the used pairs from the serialized classifier
that was used/retrained in order to correctly assess the classifier. The
default behavior is to use the retrained classifier for any sessions
where the actual classifier was not found or was unable to be loaded.
Legacy-formatted classifiers are not supported for re-loading. In cases
where a stim session was restarted, the default behavior is to use the
original classifier (i.e. the classifier before artifact detection) rather
than trying to guess which classifier to load.</p>
</dd></dl>

<dl class="function">
<dt id="ramutils.tasks.classifier.reload_used_classifiers">
<code class="descclassname">ramutils.tasks.classifier.</code><code class="descname">reload_used_classifiers</code><span class="sig-paren">(</span><em>subject</em>, <em>experiment</em>, <em>events</em>, <em>root</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/tasks/classifier.html#reload_used_classifiers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.classifier.reload_used_classifiers" title="Permalink to this definition">¶</a></dt>
<dd><p>Reload the actual classifiers used in each session of an experiment</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>subject</strong> (<em>str</em>) – Subject identifier</li>
<li><strong>experiment</strong> (<em>str</em>) – Name of the experiment</li>
<li><strong>sessions</strong> (<em>list</em>) – List of sessions to try reloading a classifier</li>
<li><strong>root</strong> (<em>str</em>) – Base path of where to find RHINO files</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">List of ClassifierContainer objects of length n_sessions</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>If a classifier is not found or is unable to be reloaded (legacy storage
format, or other issues), then the list of ClassifierContainer objects
will have None as the entry for that session.</p>
</dd></dl>

</div>
<div class="section" id="module-ramutils.tasks.events">
<span id="events-tasks"></span><h3>Events tasks<a class="headerlink" href="#module-ramutils.tasks.events" title="Permalink to this headline">¶</a></h3>
<p>Partial pipelines for processing events that is used by full pipelines.</p>
<dl class="function">
<dt id="ramutils.tasks.events.build_test_data">
<code class="descclassname">ramutils.tasks.events.</code><code class="descname">build_test_data</code><span class="sig-paren">(</span><em>subject</em>, <em>experiment</em>, <em>paths</em>, <em>joint_report</em>, <em>sessions=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/tasks/events.html#build_test_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.events.build_test_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct the set of events to be used for post-hoc classifier
evaluation, i.e. the test data</p>
</dd></dl>

<dl class="function">
<dt id="ramutils.tasks.events.build_training_data">
<code class="descclassname">ramutils.tasks.events.</code><code class="descname">build_training_data</code><span class="sig-paren">(</span><em>subject</em>, <em>experiment</em>, <em>paths</em>, <em>sessions=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/tasks/events.html#build_training_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.events.build_training_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct the set of events needed for classifier training</p>
</dd></dl>

</div>
<div class="section" id="module-ramutils.tasks.misc">
<span id="miscellaneous-tasks"></span><h3>Miscellaneous tasks<a class="headerlink" href="#module-ramutils.tasks.misc" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="ramutils.tasks.misc.read_index">
<code class="descclassname">ramutils.tasks.misc.</code><code class="descname">read_index</code><span class="sig-paren">(</span><em>mount_point='/'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/tasks/misc.html#read_index"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.misc.read_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads the JSON index reader.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>mount_point</strong> (<em>str</em>) – Root directory to search for.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">JsonIndexReader</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ramutils.tasks.misc.save_all_output">
<code class="descclassname">ramutils.tasks.misc.</code><code class="descname">save_all_output</code><span class="sig-paren">(</span><em>subject</em>, <em>experiment</em>, <em>session_summaries</em>, <em>math_summaries</em>, <em>classifier_evaluation_results</em>, <em>save_location</em>, <em>retrained_classifier=None</em>, <em>target_selection_table=None</em>, <em>behavioral_results=None</em>, <em>agg_report=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/tasks/misc.html#save_all_output"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.misc.save_all_output" title="Permalink to this definition">¶</a></dt>
<dd><p>Save all required output necessary to re-generate a report</p>
<dl class="docutils">
<dt>subject: str</dt>
<dd>Subject ID</dd>
<dt>experiment: str</dt>
<dd>Experiment name</dd>
<dt>session_summaries: List</dt>
<dd>List of SessionSummary derived objects</dd>
<dt>math_summaries: List</dt>
<dd>List of MathSummary objects</dd>
<dt>classifier_evaluation_results: List</dt>
<dd>List of ClassifierSummary objects</dd>
<dt>save_location: str</dt>
<dd>Destination for data to be saved. Typically in
/scratch/report_database/ on RHINO</dd>
<dt>retrained_classifier: ClassifierContainer</dt>
<dd>Serialized representation of the retrained classifier</dd>
<dt>target_selection_table pd.DataFrame</dt>
<dd>DataFrame representation of the target selection table, formerly known
as the subsequent memory effect table</dd>
<dt>behavioral_results: dict</dt>
<dd>Keys are the behavioral effect model type (stim list, stim item, etc.)
and values are the traces from estimating those models</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><strong>results_files</strong> – Dictionary whose keys are the names of statically-produced plots and
values are encoded versions of those images. These are used to embed
the static plots in the html reports during report generation</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">dict</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>All output files are of the format {subject}_{experiment}_{session}_{data_type}.{file_type}
where data_type is a generic name for the type of data being saved. The following data types
map to a summary object:</p>
<ul class="simple">
<li>sessions_summary: <a class="reference internal" href="data.html#ramutils.reports.summary.SessionSummary" title="ramutils.reports.summary.SessionSummary"><code class="xref py py-class docutils literal notranslate"><span class="pre">ramutils.reports.summary.SessionSummary</span></code></a></li>
<li>math_summary: <a class="reference internal" href="data.html#ramutils.reports.summary.MathSummary" title="ramutils.reports.summary.MathSummary"><code class="xref py py-class docutils literal notranslate"><span class="pre">ramutils.reports.summary.MathSummary</span></code></a></li>
<li>classifier_[tag]: <a class="reference internal" href="data.html#ramutils.reports.summary.ClassifierSummary" title="ramutils.reports.summary.ClassifierSummary"><code class="xref py py-class docutils literal notranslate"><span class="pre">ramutils.reports.summary.ClassifierSummary</span></code></a></li>
</ul>
</dd></dl>

<dl class="function">
<dt id="ramutils.tasks.misc.load_existing_results">
<code class="descclassname">ramutils.tasks.misc.</code><code class="descname">load_existing_results</code><span class="sig-paren">(</span><em>subject</em>, <em>experiment</em>, <em>sessions</em>, <em>stim_report</em>, <em>db_loc</em>, <em>joint_report</em>, <em>rootdir='/'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/tasks/misc.html#load_existing_results"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.misc.load_existing_results" title="Permalink to this definition">¶</a></dt>
<dd><p>Load previously-saved data creating during report generation</p>
<dl class="docutils">
<dt>subject: str</dt>
<dd>Subject ID</dd>
<dt>experiment: str</dt>
<dd>Experiment ID</dd>
<dt>sessions: list or None</dt>
<dd>If none, then sessions are looked up from r1.json for the given subject and experiment.</dd>
<dt>stim_report: bool</dt>
<dd>Indicator for if the requested data is associated with a stim report</dd>
<dt>db_loc: str</dt>
<dd>Report database location relative to rootdir. db_loc will be appended to rootdir
to find the full absolute path. If both db_loc and rootdir are absolute paths,
it will be assumed that db_loc contains the root directory.</dd>
<dt>rootdir: str</dt>
<dd>RHINO mount point or root directory</dd>
</dl>
<dl class="docutils">
<dt>saved_results: dict</dt>
<dd>Mirrors the input to save_all_output</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-ramutils.tasks.montage">
<span id="montage-tasks"></span><h3>Montage tasks<a class="headerlink" href="#module-ramutils.tasks.montage" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="ramutils.tasks.montage.generate_pairs_for_classifier">
<code class="descclassname">ramutils.tasks.montage.</code><code class="descname">generate_pairs_for_classifier</code><span class="sig-paren">(</span><em>pairs</em>, <em>excluded_pairs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/montage.html#generate_pairs_for_classifier"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.montage.generate_pairs_for_classifier" title="Permalink to this definition">¶</a></dt>
<dd><p>Create recarray of electrode pairs for the classifier container</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>pairs</strong> – JSON-format object containing all electrode pairs in the
montage</li>
<li><strong>excluded_pairs</strong> – array-like containing pairs excluded from the montage</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">recarray containing all pairs minus excluded pairs</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">np.recarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ramutils.tasks.montage.reduce_pairs">
<code class="descclassname">ramutils.tasks.montage.</code><code class="descname">reduce_pairs</code><span class="sig-paren">(</span><em>pairs</em>, <em>stim_params</em>, <em>return_excluded=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/montage.html#reduce_pairs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.montage.reduce_pairs" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove stim pairs from the pairs.json dict.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>pairs</strong> (<em>OrderedDict</em>) – Full pairs.json as a dict</li>
<li><strong>stim_params</strong> (<em>List</em><em>[</em><a class="reference internal" href="data.html#ramutils.parameters.StimParameters" title="ramutils.parameters.StimParameters"><em>StimParameters</em></a><em>]</em>) – </li>
<li><strong>return_excluded</strong> (<em>bool</em>) – Whether excluded pairs should be returned instead of reduced pairs</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">pairs with stim pairs removed, or removed pairs if return_excluded is True</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">OrderedDict</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ramutils.tasks.montage.get_used_pair_mask">
<code class="descclassname">ramutils.tasks.montage.</code><code class="descname">get_used_pair_mask</code><span class="sig-paren">(</span><em>all_pairs</em>, <em>excluded_pairs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/montage.html#get_used_pair_mask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.montage.get_used_pair_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a boolean mask indicating which electrodes should be included
in classifier training/evaluation.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>all_pairs</strong> (<em>OrderedDict</em>) – </li>
<li><strong>excluded_pairs</strong> (<em>OrderedDict</em>) – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>mask</strong> – Boolean mask of channels to include.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">List[bool]</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ramutils.tasks.montage.generate_montage_metadata_table">
<code class="descclassname">ramutils.tasks.montage.</code><code class="descname">generate_montage_metadata_table</code><span class="sig-paren">(</span><em>subject</em>, <em>experiment</em>, <em>sessions</em>, <em>all_pairs</em>, <em>root='/'</em><span class="sig-paren">)</span><a class="headerlink" href="#ramutils.tasks.montage.generate_montage_metadata_table" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a dataframe containing atlas labels, locations, and coordinates</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>subject</strong> (<em>str</em>) – Subject ID</li>
<li><strong>experiment</strong> (<em>str</em>) – Experiment</li>
<li><strong>all_pairs</strong> (<em>OrderedDict</em>) – Full set of bipolar pairs that will be augmented with their metadata</li>
<li><strong>root</strong> (<em>str</em>) – Base path for RHINO</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ramutils.tasks.montage.get_pairs">
<code class="descclassname">ramutils.tasks.montage.</code><code class="descname">get_pairs</code><span class="sig-paren">(</span><em>subject_id</em>, <em>experiment</em>, <em>sessions</em>, <em>paths</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/montage.html#get_pairs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.montage.get_pairs" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine how we should figure out what pairs to use.</p>
<p>Option 1: In the case of hardware bipolar recordings with the ENS, EEG
data is stored in the HDF5 file which contains the Odin electrode config
data so we can use this.</p>
<p>Option 2: For monopolar recordings, we can just read the pairs.json from
localization.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>subject_id</strong> (<em>str</em>) – Subject ID</li>
<li><strong>experiment</strong> (<em>str</em>) – Experiment type</li>
<li><strong>sessions</strong> (<em>list</em>) – List of sessions to use</li>
<li><strong>paths</strong> (<a class="reference internal" href="data.html#ramutils.parameters.FilePaths" title="ramutils.parameters.FilePaths"><em>FilePaths</em></a>) – Object for storing important file paths</li>
<li><strong>localization</strong> (<em>int</em>) – Localization number</li>
<li><strong>montage</strong> (<em>int</em>) – Montage number</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>all_pairs</strong> – All pairs used in the experiment.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dict</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>This should only be used for getting pairs when building a report. For
config generation, use generate_pairs_from_electrode_config. To use
get_pairs, you would need to determine an open loop experiment that the
subject completed and use that experiment instead of the experiment whose
config file is being generated.</p>
</dd></dl>

<dl class="function">
<dt id="ramutils.tasks.montage.get_classifier_excluded_leads">
<code class="descclassname">ramutils.tasks.montage.</code><code class="descname">get_classifier_excluded_leads</code><span class="sig-paren">(</span><em>subject</em>, <em>all_pairs</em>, <em>rootdir='/'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/montage.html#get_classifier_excluded_leads"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.montage.get_classifier_excluded_leads" title="Permalink to this definition">¶</a></dt>
<dd><p>Identify channels to be excluded using the classifier_excluded_leads.txt file</p>
<dl class="docutils">
<dt>subject: str</dt>
<dd>Subject identifier</dd>
<dt>paths: FilePaths</dt>
<dd>FilePaths object including RHINO root directory</dd>
</dl>
<p>excluded_contacts: List of contacts in the same format as what is returned by make_stim_params</p>
</dd></dl>

<dl class="function">
<dt id="ramutils.tasks.montage.get_artifact_tstats">
<code class="descclassname">ramutils.tasks.montage.</code><code class="descname">get_artifact_tstats</code><span class="sig-paren">(</span><em>stim_events</em>, <em>pairs</em>, <em>start_time</em>, <em>duration</em>, <em>return_pvalues=False</em>, <em>before_experiment=True</em><span class="sig-paren">)</span><a class="headerlink" href="#ramutils.tasks.montage.get_artifact_tstats" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes ttest on the average EEG value pre-stim vs post-stim.
TODO: import from artdet; define parameters centrally</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>stim_events</strong> (<em>np.rec.array</em>) – Stimulation events for a session</li>
<li><strong>pairs</strong> (<em>dict</em>) – bipolar pairs</li>
<li><strong>start_time</strong> (<em>float</em>) – time after stim offset/before stim onset to begin (seconds)</li>
<li><strong>duration</strong> (<em>float</em>) – Length of eeg to evaluate (seconds)</li>
<li><strong>return_pvalues</strong> (<em>bool</em>) – If <cite>true</cite>, return p-values along with t-statistics</li>
<li><strong>before_experiment</strong> – If <cite>true</cite>, only include stim events before the first list</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>t</strong> (<em>np.ndarray</em>) – T-statistics by channel</li>
<li><strong>p</strong> (<em>np.ndarray</em>) – p-values by channel</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-ramutils.tasks.odin">
<span id="odin-ramulator-tasks"></span><h3>Odin/Ramulator tasks<a class="headerlink" href="#module-ramutils.tasks.odin" title="Permalink to this headline">¶</a></h3>
<p>Tasks specific to the Medtronic Odin ENS.</p>
<dl class="function">
<dt id="ramutils.tasks.odin.generate_electrode_config">
<code class="descclassname">ramutils.tasks.odin.</code><code class="descname">generate_electrode_config</code><span class="sig-paren">(</span><em>subject</em>, <em>paths</em>, <em>anodes=None</em>, <em>cathodes=None</em>, <em>localization=0</em>, <em>montage=0</em>, <em>default_surface_area=0.001</em>, <em>use_common_reference=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/tasks/odin.html#generate_electrode_config"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.odin.generate_electrode_config" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate electrode configuration files (CSV and binary).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>subject</strong> (<em>str</em>) – Subjebct ID</li>
<li><strong>paths</strong> (<a class="reference internal" href="data.html#ramutils.parameters.FilePaths" title="ramutils.parameters.FilePaths"><em>FilePaths</em></a>) – </li>
<li><strong>anodes</strong> (<em>List</em><em>[</em><em>str</em><em>]</em>) – List of stim anode labels.</li>
<li><strong>cathodes</strong> (<em>List</em><em>[</em><em>str</em><em>]</em>) – List of stim cathode labels.</li>
<li><strong>localization</strong> (<em>int</em>) – Localization number (default: 0)</li>
<li><strong>montage</strong> (<em>int</em>) – Montage number (default: 0)</li>
<li><strong>default_surface_area</strong> (<em>float</em>) – Default surface area to set all electrodes to in mm^2. Only used if no
area file can be found.</li>
<li><strong>use_common_reference</strong> (<em>bool</em>) – Use common reference instead of bipolar referencing scheme.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>paths</strong> – Updated <code class="xref py py-class docutils literal notranslate"><span class="pre">FilePaths</span></code> object with path to the electrode config file
defined.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference internal" href="data.html#ramutils.parameters.FilePaths" title="ramutils.parameters.FilePaths">FilePaths</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>At present, this will only allow for generating hardware-bipolar electrode
config files.</p>
</dd></dl>

<dl class="function">
<dt id="ramutils.tasks.odin.generate_ramulator_config">
<code class="descclassname">ramutils.tasks.odin.</code><code class="descname">generate_ramulator_config</code><span class="sig-paren">(</span><em>subject</em>, <em>experiment</em>, <em>container</em>, <em>stim_params</em>, <em>paths</em>, <em>pairs=None</em>, <em>excluded_pairs=None</em>, <em>exp_params=None</em>, <em>extended_blanking=True</em>, <em>trigger_pairs=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/tasks/odin.html#generate_ramulator_config"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.odin.generate_ramulator_config" title="Permalink to this definition">¶</a></dt>
<dd><p>Create configuration files for Ramulator.</p>
<p>In hardware bipolar mode, the neurorad pipeline generates a <code class="docutils literal notranslate"><span class="pre">pairs.json</span></code>
file that differs from the electrode configured pairs. It is up to the user
of the pipeline to ensure that the path to the correct <code class="docutils literal notranslate"><span class="pre">pairs.json</span></code> is
supplied (although Ramulator does not use it in this case).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>subject</strong> (<em>str</em>) – </li>
<li><strong>experiment</strong> (<em>str</em>) – </li>
<li><strong>container</strong> (<em>ClassifierContainer</em><em> or </em><em>None</em>) – serialized classifier</li>
<li><strong>stim_params</strong> (<em>List</em><em>[</em><a class="reference internal" href="data.html#ramutils.parameters.StimParameters" title="ramutils.parameters.StimParameters"><em>StimParameters</em></a><em>]</em>) – list of stimulation parameters</li>
<li><strong>paths</strong> (<a class="reference internal" href="data.html#ramutils.parameters.FilePaths" title="ramutils.parameters.FilePaths"><em>FilePaths</em></a>) – </li>
<li><strong>excluded_pairs</strong> (<em>dict</em>) – Pairs excluded from the classifier (pairs that contain a stim contact
and possibly some others)</li>
<li><strong>exp_params</strong> (<a class="reference internal" href="data.html#ramutils.parameters.ExperimentParameters" title="ramutils.parameters.ExperimentParameters"><em>ExperimentParameters</em></a>) – All parameters used in training the classifier. This is partially
redundant with some data stored in the <code class="docutils literal notranslate"><span class="pre">container</span></code> object.</li>
<li><strong>extended_blanking</strong> (<em>bool</em>) – Whether or not to enable the ENS extended blanking (default: True).</li>
<li><strong>trigger_pairs</strong> (<em>List</em><em>[</em><em>str</em><em>] or </em><em>None</em>) – Pairs to be used for triggering stim in PS5.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>zip_path</strong> – Path to generated configuration zip file</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">str</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-ramutils.tasks.powers">
<span id="power-computation-tasks"></span><h3>Power computation tasks<a class="headerlink" href="#module-ramutils.tasks.powers" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="ramutils.tasks.powers.reduce_powers">
<code class="descclassname">ramutils.tasks.powers.</code><code class="descname">reduce_powers</code><span class="sig-paren">(</span><em>powers</em>, <em>channel_mask</em>, <em>n_frequencies</em>, <em>frequency_mask=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/powers.html#reduce_powers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.powers.reduce_powers" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a subset of the full power matrix by excluding certain electrodes</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>powers</strong> (<em>np.ndarray</em>) – Original power matrix</li>
<li><strong>channel_mask</strong> (<em>array_like</em>) – Boolean array of size n_channels</li>
<li><strong>n_frequencies</strong> (<em>int</em>) – Number of frequencies used in calculating the power matrix. This is
needed to be able to properly reshape the array</li>
<li><strong>frequency_mask</strong> (<em>array_like</em>) – Boolean array of size n_frequencies</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Subsetted power matrix</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">np.ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ramutils.tasks.powers.compute_normalized_powers">
<code class="descclassname">ramutils.tasks.powers.</code><code class="descname">compute_normalized_powers</code><span class="sig-paren">(</span><em>events</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/powers.html#compute_normalized_powers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.powers.compute_normalized_powers" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute powers by session, encoding/retrieval, and FR vs. PAL</p>
<p class="rubric">Notes</p>
<p>There are different start times, end time, and buffer times for each
subset type, so those are passed in as kwargs and looked up prior to
calling the more general compute_powers function</p>
</dd></dl>

<dl class="function">
<dt id="ramutils.tasks.powers.get_trigger_frequency_mask">
<code class="descclassname">ramutils.tasks.powers.</code><code class="descname">get_trigger_frequency_mask</code><span class="sig-paren">(</span><em>trigger_frequency</em>, <em>frequencies</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/powers.html#get_trigger_frequency_mask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.powers.get_trigger_frequency_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a boolean mask identifying a single frequency in a list of
frequencies</p>
</dd></dl>

</div>
<div class="section" id="module-ramutils.tasks.summary">
<span id="report-summary-tasks"></span><h3>Report summary tasks<a class="headerlink" href="#module-ramutils.tasks.summary" title="Permalink to this headline">¶</a></h3>
<p>Tasks related to summarizing an experiment. Used primarily in reporting
results.</p>
<dl class="function">
<dt id="ramutils.tasks.summary.summarize_nonstim_sessions">
<code class="descclassname">ramutils.tasks.summary.</code><code class="descname">summarize_nonstim_sessions</code><span class="sig-paren">(</span><em>all_events</em>, <em>task_events</em>, <em>bipolar_pairs</em>, <em>excluded_pairs</em>, <em>normalized_powers</em>, <em>joint=False</em>, <em>repetition_ratio_dict={}</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/tasks/summary.html#summarize_nonstim_sessions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.summary.summarize_nonstim_sessions" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a summary by unique session/experiment</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>all_events</strong> (<em>np.recarray</em>) – Full set of events</li>
<li><strong>task_events</strong> (<em>np.recarray</em>) – Event subset used for classifier training</li>
<li><strong>joint</strong> (<em>Bool</em>) – Indicator for if a joint report is being created. This will disable
checks for single-experiment events</li>
<li><strong>repetition_ratio_dict</strong> (<em>Dict</em>) – Mapping between subject ID and repetition ratio data</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>summary</strong> – List of SessionSummary objects for the proper experiment type.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first">list</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TooManyExperimentsError</span></code> – If the events span more than one session.</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>The experiment type is inferred from the events.</p>
</dd></dl>

<dl class="function">
<dt id="ramutils.tasks.summary.summarize_math">
<code class="descclassname">ramutils.tasks.summary.</code><code class="descname">summarize_math</code><span class="sig-paren">(</span><em>events</em>, <em>joint=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/tasks/summary.html#summarize_math"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.summary.summarize_math" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a summary math event summary of a single experiment session</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>events</strong> (<em>np.recarray</em>) – Events from single experiment session</li>
<li><strong>joint</strong> (<em>Bool</em>) – Indicates if the given events are part of a joint event, and therefore
multiple experiments should be allowed</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>summary</strong> – List of MathSummary objects</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ramutils.tasks.summary.summarize_stim_sessions">
<code class="descclassname">ramutils.tasks.summary.</code><code class="descname">summarize_stim_sessions</code><span class="sig-paren">(</span><em>all_events</em>, <em>task_events</em>, <em>stim_params</em>, <em>pairs_data</em>, <em>bipolar_pairs</em>, <em>excluded_pairs</em>, <em>normalized_powers</em>, <em>encoding_classifier_summaries=None</em>, <em>post_stim_predicted_probs=None</em>, <em>trigger_output=None</em>, <em>post_stim_trigger_output=None</em>, <em>post_stim_eeg=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/tasks/summary.html#summarize_stim_sessions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.summary.summarize_stim_sessions" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct stim session summaries</p>
</dd></dl>

<dl class="function">
<dt id="ramutils.tasks.summary.summarize_ps_sessions">
<code class="descclassname">ramutils.tasks.summary.</code><code class="descname">summarize_ps_sessions</code><span class="sig-paren">(</span><em>ps_events</em>, <em>bipolar_pairs</em>, <em>excluded_pairs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ramutils/tasks/summary.html#summarize_ps_sessions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ramutils.tasks.summary.summarize_ps_sessions" title="Permalink to this definition">¶</a></dt>
<dd><p>Task for generating summaries of PS session</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ps_events</strong> (<em>np.recarray</em>) – </li>
<li><strong>bipolar_pairs</strong> (<em>dict</em>) – </li>
<li><strong>excluded_pairs</strong> (<em>dict</em>) – </li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cli.html" class="btn btn-neutral float-right" title="Command-line usage" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="events.html" class="btn btn-neutral" title="Event processing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>